# Making Clash Royale's Ranking System More Enjoyable: How simulating 4 billion battles tells us how to shorten the Path of Legends

*Investigation by Ryan Butler*

## Abstract: 

In this investigation, I model Clash Royale's Path of Legends (PoL) ranking system. Using this model, I can gain insights about the PoL and determine the effects of moving/removing golden steps on the percentage of players who reach Ultimate champion. After investigating the behavior of 10 different path frameworks, I found two frameworks (one with 55 steps and one with 66 steps) that have a UC attainment rate under 1%, maximize the winrate of players reaching UC and may decrease the number of games to reach UC. These paths can also be climbed almost as fast or faster than the current path in the best case. The two path frameworks are wildly different and the choice of which is "better" depends on the ideological goal for the Path of Legends. 

<img src="./graphs/shortpaths.png" alt="Best path framework", style="height:200px; width:400px;"/>

The source code, PoL frameworks and summaries of results are in [this github repo](https://github.com). *I will not delve into the technical details in this writeup, but I am happy to explain what I did on the technical end and why I made the optimization and design choices I made.*

## Introduction

Finishing the Path of Legends (abbreviated as PoL) requires reaching the highest league, Ultimate Champion (UC). The current Path of Legends system requires 93 steps, which could be as many as 93 wins without losing once. If you reach Ultimate Champ in the previous season and win every game and receive a 10x multiplier (The multiplier allows you to get multiple steps per win, decreasing how much you need to play), you can finish in 48 games. Not many players can win 48/48 games and the actual amount of gameplay required to reach UC is normally much higher. That being said, this number is still important since highly skilled players with >90% winrates (particularly players who will finish near the top of the leaderboards) do come near this fastest possible path completion. In this write up, I will detail how I built and used a computational model of the PoL to find a PoL framework that will best align to these 3 principles:

1. Given $n$ battles played per season, close to 1% of players will reach Ultimate Champion. 
2. Minimize the number of games required to reach Ultimate Champion
3. The Win Pct of the UC players should be maximized (Only the best 1% of players should be reaching UC)


## Method:

### Simplifying Assumptions

First, I built a computational model of the system and made 2 simplifying assumptions:

- Player card and king levels do not matter due to the path level caps. The sole factor in determining who wins a battle is dependent on the two player's legacy bests since it wraps up card level and king level conveniently. One major limitation with this approach is that there are no players that are at the highest skill level and can beat almost anyone, resulting in no players with >90% winrates. 
- The players skill/levels stay the same throughout the testing. All 500000 players tested were generated by examining 24000 real players from the offical CR api and getting their card level and trophy PBs.

When 2 players match against each other under this assumption, the probably of the higher PB player winning the match, with a given PB difference $d$ is approximated by the equation:

$-0.0000001097213  d^{2}+ 0.00030971 d + 0.48544$

This approximation is from roughly 80000 real battles of players at tournament standard with equal levels. 

### Data Collection Process

First I needed to know how long to run my model for each path framework. I simulated the current path system (with parameters taken from the game) with 500k players until 1% of players reached UC.  It took roughly 62 million battles for 1% of the playerbase in UC. I ran this simulation for 5 seasons to ensure that the effect of the win multiplier took affect. (I would consistently see that after 3-4 seasons the number of UC players was pretty consistent, so I ran it for one extra season to get the final value)  The number of battles required tended to reach a steady value about 4-5 seasons, sometimes earlier. 

With the calibration for the simulation complete, I could experiment with the path framework. Each experiment was run by doing 10 trials (with rng seeds 0-9 for reproducability) and calculating the Avg and Stdev 3 things:
- Finishing Step
- Games played to reach UC (UC players only)
- Win Percent (UC PLayers only)

Finally I calculated the average number of UC players. The goal was for this final average to be close to 1% and created some plots for the data. 

## Results:
There were 10 new path frameworks that were studied in this investigation. When I say no gold steps, I mean no gold steps except for the bottom step. I began by running the simulation on the current PoL model. The PoL is divided up into 10 leagues. Each league has a number of steps required to reach it. The Gold step rule is the number of wins required when in a given league to get a "gold" step. Gold steps mean that losing doesn't decrease your step progress. The more frequently gold steps appear, the faster players climb through the league.   The multiplier is determined by which league a player ends up in. The max multiplier means that anyone above a given league gets this fixed multiplier. 

### Current Path with 93 steps:

| League | 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | UC | 
| --- | --- |  --- | --- | --- | ---- | --- | --- | --- | --- | --- |
| Step Requirement | 0 | 10 | 21 | 32 | 43 | 54 | 65 | 73 | 82 | 93 |
| Gold Step rule | 2 | 3 | 4 | 5 | 6 | 7 | 0 | 0 | 0 |  N/A |

Drop Leagues: False, Max Multiplier: 9 

| Statistic | Average | St Dev. |
| ------| --- | --- |
| Finishing Step | 58 | 11.4935 |
| UC Games Played | 257.3 | 31.2986 |
| UC Win Percent | 0.593175 | 0.0185538 |
Percent UC:  0.9968

<img src="./graphs/currentPath.png" alt="currentPath.png", style="height:500px; width:500px;"/>

 With the current system, players took on average 257 games to finish the path. Many players finish faster than this, but 257 games is a significant time investment.  There are quire a few players reaching UC with a win percent less than 60%. In the histogram of finishing steps, there is a signifigant drop off of players between steps 65 and 70. This is due to the *final* golden step being at step 65. 

### 55-step path with less gold Steps:

| League | 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | UC | 
| --- | --- |  --- | --- | --- | ---- | --- | --- | --- | --- | --- |
| Step Requirement | 0 | 5 | 10 | 15 | 21 | 27 | 33 | 40 | 47 | 55 |
| Gold Step rule | 4 | 3 | 2 | 0 | 0 | 0 | 0 | 0 | 0 |  N/A |
Drop Leagues: True, Max Multiplier: 6 

| Statistic | Average | St Dev. |
| ------| --- | --- |
| Finishing Step | 26 | 10.6771 |
| UC Games Played | 222.2 | 46.9734 |
| UC Win Percent | 0.591978 | 0.0252655 |
Percent UC:  5.17024

<img src="./graphs/lessgoldsteps.png" alt="Removing most gold steps", style="height:500px; width:500px;"/>

With a path length of 55, even taking away most of the golden steps, there were 5x the amount of UC players as I intended; the path is simply too short. The average number of steps to reach UC was down but the difference was not statistically significant. The graph of the games played to reach UC was also bimodal. The first group of players was finishing in roughly 175 matches, which is the fastest. The next experiment tried to adjust this by lengthening the path to 65 steps with the same golden step rules. 


### 65-step path with less gold steps:

| League | 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | UC | 
| --- | --- |  --- | --- | --- | ---- | --- | --- | --- | --- | --- |
| Step Requirement | 0 | 5 | 10 | 15 | 21 | 28 | 36 | 45 | 55 | 65 |
| Gold Step rule | 4 | 3 | 2 | 0 | 0 | 0 | 0 | 0 | 0 |  N/A |
Drop Leagues: True, Max Multiplier: 6 

| Statistic | Average | St Dev. |
| ------| --- | --- |
| Finishing Step | 26 | 11.4018 |
| UC Games Played | 239 | 38.3523 |
| UC Win Percent | 0.60371 | 0.022345 |
Percent UC:  1.85394

<img src="./graphs/lessgoldsteps2.png" alt="Removing most gold steps", style="height:500px; width:500px;"/>

This path was similar to the previous but lengening it by 10 steps. This cut the UC percentage under 2%, but wasn't near the 1% goal.  By lengthening the path, the average number of steps to UC was increased, but unfortunately the same bimodal distribution disappeared and I couldn't preserve the 175 peak seen in the 55-step path. Interestingly, the average finishing step was the same as in the 55-step path.

### 60-step path with no gold steps:
 
 League | 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | UC | 
| --- | --- |  --- | --- | --- | ---- | --- | --- | --- | --- | --- |
| Step Requirement | 0 | 6 | 13 | 20 | 27 | 34 | 41 | 48 | 54 | 60 |
| Gold Step rule | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | N/A |
Drop Leagues: True, Max Multiplier: 5

| Statistic | Average | St Dev. |
| ------| --- | --- |
| Finishing Step | 14 | 11.8996 |
| UC Games Played | 242.8 | 37.7677 |
| UC Win Percent | 0.60456 | 0.020625 |
Percent UC:  0.54826 

<img src="./graphs/noGoldInLeague.png" alt="Removing all gold steps, but a medium multiplier", style="height:500px; width:500px;"/>

This trial used absolutely no gold steps except for the bottom one. This was the toughest path I experimented with since only 0.54% of players reached the end. The fastest that a player can finish this path is in 50 steps. Due to the difficulty of this path, it took a long time to reach UC for most players.


### 55-step path with no gold steps in leagues:

| League | 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | UC | 
| --- | --- |  --- | --- | --- | ---- | --- | --- | --- | --- | --- |
| Step Requirement | 0 | 6 | 12 | 18 | 24 | 30 | 36 | 42 | 48 | 55 |
| Gold Step rule | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | N/A |
Drop Leagues: False

Max Multiplier: 4 

Statistic | Average | St Dev. |
| --- | --- | --- |
| Finishing Step | 14 | 11.3137 |
| UC Games Played | 238.2 | 39.4943 |
| UC Win Percent | 0.603848 | 0.022751 |
Percent UC:  0.91346

<img src="./graphs/nogoldinleague2.png" alt="Removing all gold steps in league, but steps at the bottom of the league stay", style="height:500px; width:500px;"/>

This path was able to cut the average number of steps to reach UC down slightly and also comes very close to a 1% UC rate. The path can be completed in 49 steps. This also manages to keep golden steps between the leagues, but still shortens the path.

### 33-step path with no gold steps or multiplier:

| League | 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | UC | 
| --- | --- |  --- | --- | --- | ---- | --- | --- | --- | --- | --- |
| Step Requirement | 0 | 3 | 6 | 9 | 12 | 16 | 20 | 24 | 28 | 33 |
| Gold Step rule | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | N/A |

Drop Leagues: True, Max Multiplier: 1 

 Statistic | Average | St Dev. |
| ------| --- | --- |
| Finishing Step | 12 | 9.79796 |
| UC Games Played | 200 | 51.2903 |
| UC Win Percent | 0.584974 | 0.0286103 |

Percent UC:  10.3074

<img src="./graphs/nogoldnomult.png" alt="Removing most gold steps", style="height:500px; width:500px;"/>

This framework removed all golden steps and the multiplier. Although the steps to reach UC was down to 200, 10% of players reached UC, which is far too high. Once again, this path is too short. The next experiment lengthened this path to 45 steps. 

### 45-step path with no gold steps or multiplier:

| League | 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | UC | 
| --- | --- |  --- | --- | --- | ---- | --- | --- | --- | --- | --- |
| Step Requirement | 0 | 4 | 8 | 12 | 16 | 21 | 26 | 32 | 38 | 45 |
| Gold Step rule | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 |  N/A |
Drop Leagues: True, Max Multiplier: 1 

| Statistic | Average | St Dev. |
| ------| --- | --- |
| Finishing Step | 13 | 10.3923 |
| UC Games Played | 229 | 43.1729 |
| UC Win Percent | 0.59417 | 0.0247397 |
Percent UC:  2.60978

<img src="./graphs/lessgoldsteps2.png" alt="Removing most gold steps", style="height:500px; width:500px;"/>

Lengthening the path once again, this did exactly what was expected: It reduced the number of UCs, but not quite all the way to 1%. The number of games to reach UC also increased and isn't far off the current path's average.  This path could be completed in 45 games, which is a slight improvement over the current system.

### 35-step path with no gold steps and small multiplier
| League | 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | UC | 
| --- | --- |  --- | --- | --- | ---- | --- | --- | --- | --- | --- |
| Step Requirement | 0 | 3 | 6 | 9 | 12 | 16 | 20 | 25 | 30 | 35 |
| Gold Step rule | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 |  N/A |
Drop Leagues: True, Max Multiplier: 4

| Statistic | Average | St Dev. |
| ------| --- | --- |
| Finishing Step | 13 | 10.4403 |
| UC Games Played | 187 | 53.0745 |
| UC Win Percent | 0.58381 | 0.032679 |
Percent UC:  10.6504

<img src="./graphs/nogoldsteps.png" alt="Removing most gold steps", style="height:500px; width:500px;"/>

The 10% UC rate tells us the important takeaway: This path is simply too short. It can be completed in 29 steps, but 10x as many people are finishing it. 
 
### 60-step path, dropping leagues allowed:
| League | 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | UC | 
| --- | --- |  --- | --- | --- | ---- | --- | --- | --- | --- | --- |
| Step Requirement | 0 | 6 | 13 | 20 | 27 | 34 | 41 | 48 | 54 | 60 |
| Gold Step rule | 2 | 3 | 4 | 5 | 6 | 7 | 0 | 0 | 0 |  N/A |
Drop Leagues: True, Max Multiplier: 5

| Statistic | Average | St Dev. |
| ------| --- | --- |
| Finishing Step | 43 | 8.30662 |
| UC Games Played | 225.4 | 37.7849 |
| UC Win Percent | 0.596047 | 0.0244686 |
Percent UC:  10.4715

<img src="./graphs/shortdropleagues.png" alt="Shorter path, allowing dropping leagues", style="height:500px; width:500px;"/>

This experiment tried taking the golden steps between leagues out and leaving in the ones in the leagues themselves. Even with a 65 step path, this resulted in a very high 10% UC rate. The next experiment lengthens the path to 75 to try to lower this. Once again there was a bimodal distribution in the UC games required but I was unable to isolate this. 


### 75-step path, dropping leagues allowed
| League | 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | UC | 
| --- | --- |  --- | --- | --- | ---- | --- | --- | --- | --- | --- |
| Step Requirement | 0 | 8 | 15 | 23 | 31 | 38 | 44 | 57 | 66 | 75 |
| Gold Step rule | 2 | 3 | 4 | 5 | 6 | 7 | 0 | 0 | 0 |  N/A |
Drop Leagues: True, Max Multiplier: 8 


| Statistic | Average | St Dev. |
| ------| --- | --- |
| Finishing Step | 49 | 10.4499 |
| UC Games Played | 234 | 40.0137 |
| UC Win Percent | 0.596399 | 0.0211164 |
Percent UC:  6.26232

<img src="./graphs/shortdropleagues2.png" alt="Shorter path, allowing dropping leagues", style="height:500px; width:500px;"/>

This path corrects the previous one's shortcomings partially. The UC percent is still too high at 6% and the path is almost as long as the path in game. This tells us that removing the golden steps between leagues isn't particularly useful in limiting the number of UC players. 

### 66-step path with no golden steps and a big multiplier

| League | 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | UC | 
| --- | --- |  --- | --- | --- | ---- | --- | --- | --- | --- | --- |
| Step Requirement | 0 | 8 | 16 | 24 | 32 | 39 | 45 | 52 | 59 | 66 |
| Gold Step rule | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 |  N/A |
Drop Leagues: True, Max Multiplier: 10 

 Statistic | Average | St Dev. |
| ------| --- | --- |
| Finishing Step | 16 | 12.6886 |
| UC Games Played | 214.6 | 62.3747 |
| UC Win Percent | 0.570985 | 0.0335147 |
Percent UC:  0.5258

<img src="./graphs/noGoldBigMult.png" alt="No gold steps, faster fastest path", style="height:500px; width:500px;"/>

This path allows players to finish in 21 steps, which is the fastest path framework I experimented. This path is also remarkably harsh since only 0.5% of players reach UC.  The distribution is close to negative binomial after the mean at 16 steps. 

## Conclusion

Based on the frameworks tested, there are two frameworks that align with the goals best: 

1. 55 step path

| League | 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | UC | 
| --- | --- |  --- | --- | --- | ---- | --- | --- | --- | --- | --- |
| Step Requirement | 0 | 6 | 12 | 18 | 24 | 30 | 36 | 42 | 48 | 55 |
| Gold Step rule | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 |  N/A |
Drop Leagues: False, Max Multiplier: 4


2. 66 steps path

| League | 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | UC | 
| --- | --- |  --- | --- | --- | ---- | --- | --- | --- | --- | --- |
| Step Requirement | 0 | 8 | 16 | 24 | 32 | 39 | 45 | 52 | 59 | 66 |
| Gold Step rule | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 |  N/A |
Drop Leagues: True, Max Multiplier: 10 

The number of battles required to reach UC was slightly lower for each path than the current path, but the difference was not statistically significant. In the 55 step path, the winrate required to reach UC was slightly higher than the current path, but the winrate required in the 66 step path was decreased slightly. Due to the system for determining who wins a match, there was no data regarding the rarer 90%+ WR players, which I think loses some important insights into the path dynamics. These players are a small minority, but are important for the competitive gamemode. In the 55 step path, reaching UC is possible in 49 steps but in the 66 step path, this can be done in just 21 steps. Both these frameworks maintain a UC rate that is below 1%, meaning that UC is relatively competitive atmosphere, as should be the case for ranked mode. 

Another interesting point worth bringing up is how the 55 step path maintains gold steps between the leagues. There are a few interesting points about this: 

- It is already in the game, it is easier for SC to implement
- Calculating WR for a player once they reach master 1 is much easier since you cannot drop leagues
- Golden step safety nets make it more likely for casual players to play the mode. 

The best path between these two paths depends on what the goals for the Path of Legends are: 

If the goal of the path is to be a cutthroat ranked mode where top players thrive but casuals are extremely challenged, than the 66-step path is better due to the low UC percentage and the ability to reach UC in 21 matches. On the other hand, if the mode is supposed to be a level capped ladder that is inviting for all players to play, then the 55 step ladder would be more appropriate since the gold steps make it more casual. Yes it is possible to reach UC with a WR of less than 10%, but in order to do that, the player must play a significant amount of games and the rating that their skills could earn them is significantly higher than what they actually earned. 

### Acknowledgements:

I first was motivated to try and investigate this from members of the Orange Juice Family who were complaining about how long the Path of Legends took. Thanks to my discord server members for feedback on this work. 